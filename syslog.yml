---
- name: Update ssh known host
  hosts:
    - azure_ec2
  gather_facts: no
  roles:
    - known_hosts

- name: Create extension
  hosts:
    - azure_ec2
  tasks:
    - name: search log analytics workspace
      azure_rm_loganalyticsworkspace_facts:
        resource_group: "{{ hostvars[inventory_hostname].resource_group
        }}"
        name: "hub-jdongmo-caea-law01"
        show_intelligence_packs: true
        show_management_groups: true
        show_usages: true
        show_shared_keys: true
      delegate_to: localhost
      register: azure_law_facts

#    - name: search VM Extension
#      azure_rm_virtualmachineextension_facts:
#        name: "{{ inventory_hostname }}-ext01" 
#        resource_group: "{{ hostvars[inventory_hostname].resource_group
#        }}"
#        virtual_machine_name: "{{ inventory_hostname }}"
#      delegate_to: localhost
#    - name: Create VM Extension
#      azure_rm_virtualmachineextension:
#        name: "{{ inventory_hostname }}-ext01" 
#        resource_group: "{{ hostvars[inventory_hostname].resource_group
#        }}"
#        virtual_machine_name: "{{ inventory_hostname }}"
#        publisher: "Microsoft.EnterpriseCloud.Monitoring"
#        virtual_machine_extension_type: "OmsAgentForLinux"
#        type_handler_version: "1.7"
#        auto_upgrade_minor_version: true
#        state: "present"
#      delegate_to: localhost
#
- name: Create syslog server
  hosts:
    - azure_ec2
  gather_facts: yes
  roles:
    - rsyslog
...
